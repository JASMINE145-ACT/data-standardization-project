# 数据标准化 · 匹配规则与匹配逻辑说明（供客户确认）

以下为「名称 → 编码」的完整匹配规则与匹配逻辑，请贵方逐条核对是否与业务预期一致。确认无误后，将按此规则实现与维护。

---

## 一、输入预处理（所有名称在参与匹配前都会做）

1. **空白**：连续空格合并为单个空格，去掉首尾空格。
2. **引号**：尺寸中的引号与数字之间的空格会被去掉（例如 `1/2 "` 视为 `1/2"`）。
3. **大小写**：匹配时**不区分大小写**。例如 "PVC-U" 与 "pvc-u" 视为相同；"White" 与 "white" 视为相同。
4. **材质词**：材质（PVC-U、PVC-C、**PE**、PPR）必须作为**独立词语**出现。例如名称里出现 "**pipe**" 时，不会把其中的 "pe" 当成材质 "PE" 来匹配，避免误判。

---

## 二、ERP 产品名称 → 10 位产品编码

### 2.1 编码结构（10 位）

| 位置 | 长度 | 含义 | 取值说明 |
|------|------|------|----------|
| 第 1 位 | 1 | 大类 | 固定为 1（管道系统） |
| 第 2–4 位 | 3 | 中类 | 101 = 管道，102 = 管件 |
| 第 5–6 位 | 2 | 子类 | 管道：材质(1)+标准(1)；管件：管件类型(2) |
| 第 7–10 位 | 4 | 序号段 | 管道：颜色(1)+压力(1)+尺寸(2)；管件：见下 |

### 2.2 匹配流程（两步，按顺序执行）

**第一步：精确表匹配**

- 系统内有一张「标准名称 → 10 位编码」对照表（当前约 28 条，来自规则文档）。
- 输入名称经上述预处理后，与表中每条「标准名称」逐条比较（比较时忽略大小写）。
- **若与表中某条完全一致** → 直接返回该条对应的 10 位编码，**不再做第二步**。
- 若与表中任一条都不一致 → 进入第二步。

**第二步：按名称内容拆解后拼码（组分解析）**

- 系统根据名称内容判断：这是「管道」还是「管件」。
- 再从名称中识别：材质、标准、颜色、压力、尺寸、管件类型等，并按下述对照表转换成数字，按固定顺序拼接成 10 位编码。
- **若缺少必要信息**（例如管道缺少材质或标准）→ 判定为**无法编码**，不产出编码。

### 2.3 管道 / 管件的判定逻辑

- **视为管道**：名称中出现 "pipe"（或 "Pipe" 等），且**不**出现 "fitting"（或 "Fitting" 等）。
- **视为管件**：名称中出现 "fitting"，或出现以下任一**类型词**（不区分大小写）：  
  socket、elbow、tee、valve、union、flange、reducer、cross、clamp、cap、bridge。

若既不是管道也不是管件（例如没有 "pipe" 也没有上述类型词）→ 无法按本规则编码。

### 2.4 管道：从名称中识别的内容与对照表

**材质（必须能识别到一种）**：PVC-U→1, PVC-C→2, PE→3, PPR→4。

**标准（管道必须）**：GB→1, SNI→2, JIS→3, ASTM→4, EN→5。

**颜色（缺省时用 0）**：White→0, Grey→1, Blue→2, Green→3, Black→4, Cream→5, Other→9。

**压力（管道：按材质取「相对压力码」）**：PVC-U: PN10(1) PN16(2)；PVC-C: PN16(1) PN20(2)；PE: PN10(1) PN16(2) PN20(3)；PPR: PN20(1) PN25(2) PN32(3)。缺省时用 1。

**尺寸（公制/英制）**：20mm→01, 25mm→02, 32mm→03, 40mm→04, 50mm→05, 63mm→06；1/2"→51, 3/4"→52, 1"→53, 1-1/4"→54, 1-1/2"→55, 2"→56。

**管道最终 4 位序号段** = 颜色(1位) + 压力相对码(1位) + 尺寸(2位)。

### 2.5 管件：从名称中识别的内容与对照表

**管件类型（缺省 01-Socket）**：Socket→01, Elbow 90°→02, Elbow 45°→03, Tee→04, Cross→05, Reducer Socket→06, Reducer Tee→07, Valve→08, Union→09, Flange→10, Clamp→11, End Cap→12, Bridge Bend→13。

**管件用「标准码」**（与管道不同）：GB→0, SNI→1, JIS→3, ASTM→4, EN→5。缺省 0。

**管件用压力码（绝对）**：PN10→1, PN16→2, PN20→3, PN25→4, PN32→5。缺省 1。

管件 4 位序号段 = 管件标准码(1位) + max(材质码, 压力码)(1位) + 尺寸(2位)。若材质无法识别 → 不产出编码。

### 2.6 何时判定「无法编码」

既不是管道也不是管件；或管道缺少材质或标准；或管件缺少材质；或其他必要信息缺失。

---

## 三、员工信息 → 11 位 NIK（员工编号）

### 3.1 NIK 结构（11 位）

2(部门) + 2(年) + 2(月) + 1(岗位类型) + 2(职级) + 2(序号)。

### 3.2 匹配方式一：描述行精确匹配

输入格式：`部门 / 姓名 / 职位 / 日期`。与 NIK_EXAMPLES 表中 18 条描述逐字比较，完全一致则返回对应 NIK。

### 3.3 匹配方式二：按部门/年月/岗位/职级/序号生成

**部门**：Board of Directors→01, Finance/Accounting/Tax Dept→02, Procurement→03, Customer Service→04, Marketing→05, Warehouse→06, General Service→07, HR→08。

**岗位类型**：Full Time→0, Part Time→1, Internship→2。

**职级**：Director→01, Commissioner→02, Manager→03, Supervisor→04, Officer/Staff→05, Intern→06。

年月、序号格式化为 2 位后拼接成 11 位 NIK。

---

## 四、请客户确认的要点

1. 预处理：空白、引号、大小写、材质词边界的处理是否与贵方使用场景一致？  
2. ERP 两步匹配：先精确表、再组分解析，且缺必要信息则不编码，是否同意？  
3. 管道/管件判定：仅根据名称中是否含 "pipe"/"fitting" 及类型词判定，是否有例外需单独约定？  
4. 各对照表：材质、标准、颜色、压力、尺寸、管件类型、管件标准码、部门、岗位、职级等，是否有需要增删或修改的取值？  
5. 管道压力相对码：按材质分别从最低常用压力编 1、2、3 的表格是否与贵方规则一致？  
6. NIK：描述行精确匹配 + 按字段生成两种方式，以及部门/岗位/职级对照表，是否与 HR 规则一致？

若以上有任何一项需要调整，请注明具体条目与期望规则，以便更新实现与本文档。
